@page
@model AtivoPlusFrontend.Pages.Pages_Registo
@{
    ViewData["Title"] = "Registo";
    Layout = null;
}
<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registo | AtivoPlus</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <main class="min-h-screen">
    <section class="bg-gray-50 dark:bg-gray-900 py-10">
      <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto min-h-screen lg:py-0">
        <a href="#" class="flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white">
          <img class="w-8 h-8 mr-2" src="https://flowbite.s3.amazonaws.com/blocks/marketing-ui/logo.svg" alt="logo">
          AtivoPlus    
        </a>
        <div class="w-full bg-white rounded-lg shadow dark:border sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
          <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
            <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
              Cria a tua conta
            </h1>
            <form id="registoForm" class="space-y-4 md:space-y-6">
              <div>
                <label for="username" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Username</label>
                <input type="text" name="username" id="username" placeholder="O teu nome de utilizador"
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
                <div>
                    <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Password</label>
                    <input type="password" name="password" id="password" placeholder="••••••••"
                    class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                    required>
                </div>
                <div>
                    <label for="passwordConfirm" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Confirmação de Password</label>
                    <input type="password" name="passwordConfirm" id="passwordConfirm" placeholder="••••••••"
                    class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                    required>
                </div>
              <div>
                <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email</label>
                <input type="email" name="email" id="email" placeholder="nome@email.com"
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
              <div>
                <label for="telefone" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Telefone</label>
                <input type="text" name="telefone" id="telefone" placeholder="912345678"
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
              <div>
                <label for="morada" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Morada</label>
                <input type="text" name="morada" id="morada" placeholder="Rua, nº, cidade"
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
              <div>
                <label for="nif" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">NIF</label>
                <input type="text" name="nif" id="nif" placeholder="123456789"
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
              <div>
                <label for="iban" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">IBAN</label>
                <input type="text" name="iban" id="iban" placeholder="PT50..."
                  class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-[#2563eb] focus:border-[#2563eb] block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-[#3b82f6] dark:focus:border-[#3b82f6]"
                  required>
              </div>
              <button
                type="submit"
                class="w-full text-white bg-[#2563eb] hover:bg-[#1d4ed8] focus:ring-4 focus:outline-none focus:ring-[#93c5fd] font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-[#2563eb] dark:hover:bg-[#1d4ed8] dark:focus:ring-[#1e40af]">
                Criar Conta
              </button>
              <p class="text-sm font-light text-gray-500 dark:text-gray-400">
                Já tens conta? <a href="/Index"
                  class="font-medium text-[#2563eb] hover:underline dark:text-[#3b82f6]">Iniciar Sessão</a>
              </p>
            </form>
          </div>
        </div>
      </div>
    </section>
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>
  </main>

  <script>
    function showToast(message, type = "info") {
      const toast = document.createElement("div");

      let iconSVG, iconColor;
      switch (type) {
        case "success":
          iconColor = "text-green-600 dark:text-green-500";
          iconSVG = `<svg class="w-5 h-5 ${iconColor}" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414L8.414 15l-4.121-4.121a1 1 0 111.414-1.414L8.414 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>`;
          break;
        case "error":
          iconColor = "text-red-600 dark:text-red-500";
          iconSVG = `<svg class="w-5 h-5 ${iconColor}" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`;
          break;
        case "warning":
          iconColor = "text-yellow-600 dark:text-yellow-500";
          iconSVG = `<svg class="w-5 h-5 ${iconColor}" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.366-.446.998-.446 1.364 0l7.071 8.625c.329.401.05.986-.437.986H1.303c-.487 0-.766-.585-.437-.986l7.071-8.625zM11 14a1 1 0 10-2 0 1 1 0 002 0zm-.25-3.25a.75.75 0 01-1.5 0v-3a.75.75 0 011.5 0v3z" clip-rule="evenodd"/></svg>`;
          break;
        default:
          iconColor = "text-blue-600 dark:text-blue-500";
          iconSVG = `<svg class="w-5 h-5 ${iconColor}" aria-hidden="true" fill="none" viewBox="0 0 18 20" xmlns="http://www.w3.org/2000/svg"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 17 8 2L9 1 1 19l8-2Zm0 0V9"/></svg>`;
      }

      toast.className = "flex items-center w-full max-w-xs p-4 space-x-4 rtl:space-x-reverse text-gray-500 bg-white divide-x rtl:divide-x-reverse divide-gray-200 rounded-lg shadow-sm dark:text-gray-400 dark:divide-gray-700 dark:bg-gray-800";
      toast.innerHTML = `
        ${iconSVG}
        <div class="ps-4 text-sm font-normal">${message}</div>
      `;

      const container = document.getElementById("toast-container");
      container.appendChild(toast);

      setTimeout(() => {
        toast.classList.add("opacity-0", "transition-opacity", "duration-300");
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    document.getElementById('registoForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const data = {
        id: -1,
        nome: document.getElementById('username').value,
        email: document.getElementById('email').value,
        telefone: document.getElementById('telefone').value,
        morada: document.getElementById('morada').value,
        nif: document.getElementById('nif').value,
        dateTime: new Date().toISOString(),
        iban: document.getElementById('iban').value
      };

      const user = {
        username: document.getElementById('username').value,
        password: document.getElementById('password').value,
      };

      try {
        const response = await fetch('https://es.marquesserver.freeddns.org:10513/api/user/adicionar', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(user)
        });

        if (response.ok) {
          try {
            const response2 = await fetch('https://es.marquesserver.freeddns.org:10513/api/userinfo/setInfo', {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });

            if (response2.ok) {
              showToast('Conta criada com sucesso!', 'success');
              setTimeout(() => window.location.href = '/Index', 1500);
            } else {
              showToast('Erro ao criar conta.', 'error');
            }
          } catch (error) {
            showToast('Erro na ligação à API.', 'error');
            console.error(error);
          }
        } else {
          showToast('Erro ao criar utilizador.', 'error');
        }
      } catch (error) {
        showToast('Erro na ligação à API.', 'error');
        console.error(error);
      }
    });
  </script>

</body>

</html>
